<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/png" href="../kepler/logo 256x256.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=0">

    <link rel="stylesheet" href="../fonts/fonts.css">
    <link rel="stylesheet" href="../css/syntax.css">

    <!-- kepler exclusive styling -->
    <link rel="stylesheet" href="./css/main.css">
    <link rel="stylesheet" href="./css/functions.css">
    <link rel="stylesheet" href="./css/tables.css">

    <title>Kepler Documentation</title>
</head>

<body>
    <toggle onclick="ToggleSidebar(this)">
        <arrow>
    </toggle>
    <sidebar minimized="false">
        <list style="margin-bottom: 5em;">
            <section>
                <name>Home</name>
                <item load="./pages/home/intro.html">Introduction</item>
            </section>
            <section>
                <name>Types</name>
                <item load="./pages/types/boolean.html">Boolean</item>
                <item load="./pages/types/float.html">Float</item>
                <item load="./pages/types/int.html">Int</item>
                <item load="./pages/types/uint.html">uInt</item>
                <item load="./pages/types/string.html">String</item>
            </section>
            <section>
                <name>Other</name>
                <item load="./pages/generic/operations.html">Operations</item>
            </section>
            <section>
                <name>Libraries</name>
                <item load="./pages/libraries/filesystem.html">filesystem</item>
                <item load="./pages/libraries/input.html">input</item>
                <item load="./pages/libraries/math.html">math</item>
                <item load="./pages/libraries/objects.html">objects</item>
                <item load="./pages/libraries/random.html">random</item>
                <item load="./pages/libraries/time.html">time</item>
                <item load="./pages/libraries/utilities.html">utilities</item>
            </section>
        </list>
    </sidebar>

    <content>
        <div class="loading" style="position: fixed;" hidden>
            <spinner title="Loading...">&#x2B6E;</spinner> Loading...
        </div>
        <span id="content-body">
            <h1>Welcome to the Kepler docs!</h1>
            If you're brand new to Kepler, click the "Introduction" option on the left to get started.
        </span>

        <!-- remove this -->
        <!-- remove this -->
    </content>
</body>

<script>
    let main_content = document.getElementById("content-body");

    function ToggleSidebar(button) {
        const sidebar = document.querySelector('sidebar')
        let minimized = sidebar.getAttribute('minimized') == "true"
        console.log(minimized)

        if (!minimized) {
            button.setAttribute("minimized", true)
            sidebar.setAttribute("minimized", true)

            main_content.parentNode.setAttribute("expanded", true)
            // document.body.style.paddingLeft = "2em"
        } else {
            button.removeAttribute("minimized")
            sidebar.setAttribute("minimized", false)
            main_content.parentNode.removeAttribute("expanded")
            // document.body.style.paddingLeft = "5em"
        }
    }

    let spinner = document.getElementsByClassName("loading")[0]
    let current_page = "null"

    function TryLoad(item, pushstate = true) {
        try {
            let file = item.getAttribute('load')
            if (pushstate)
                history.pushState({
                    target: file
                }, `Kepler - ${item.innerText}`, `?target=${item.innerText}`)
            LoadItem(file)
        } catch (err) {
            spinner.setAttribute("hidden", true)
            main_content.innerHTML = "An error occurred while trying to load this page."
        }
    }

    window.onpopstate = function (event) {
        if (event.state.target == null) return

        try {
            LoadItem(event.state.target)
        } catch (err) {
            spinner.setAttribute("hidden", true)
            main_content.innerHTML = "An error occurred while trying to load this page."
        }
    }

    window.addEventListener("load", (e) => {
        let params = new URLSearchParams(window.location.search)
        if (!params.has("target")) return

        let target = params.get("target")

        let items = document.getElementsByTagName("item")
        for (var i = 0; i < items.length; ++i) {
            if (items[i].innerText == target) {
                TryLoad(items[i], false)
                break
            }
        }
    })

    function LoadItem(file) {
        // const file = item.getAttribute('load')
        if (file == current_page) return

        spinner.removeAttribute("hidden")
        // main_content.innerHTML = ""

        let items = document.getElementsByTagName("item")
        for (var i = 0; i < items.length; ++i) {
            if (items[i].getAttribute("load") == file)
                items[i].setAttribute("selected", true)
            else
                items[i].removeAttribute("selected")
        }

        current_page = file

        // xhttp = new XMLHttpRequest()
        // xhttp.onreadystatechange = function () {
        //     if (this.readyState == 4) {
        //         if (this.status == 200) {
        //             spinner.setAttribute("hidden", true)
        //             main_content.innerHTML = this.responseText
        //         }
        //         if (this.status == 404) {
        //             spinner.setAttribute("hidden", true)
        //             main_content.innerHTML = "Page not found."
        //         }
        //     }
        // }
        // xhttp.open("GET", file, true)

        // xhttp.send()

        fetch(file.toString()).then(res => {
            return res.text()
        }).then(html => {
            SetMainContent(html)
            spinner.setAttribute("hidden", true)
        }).catch(err => {
            xhttp = new XMLHttpRequest()

            xhttp.onreadystatechange = function () {
                if (this.readyState == 4) {
                    if (this.status == 200) {
                        spinner.setAttribute("hidden", true)
                        SetMainContent(this.responseText)
                    }
                    if (this.status == 404) {
                        spinner.setAttribute("hidden", true)

                        SetMainContent(this.responseText)
                    }
                }
            }
            xhttp.open("GET", file, true)

            xhttp.send()
        })
    }

    function SetMainContent(html) {
        main_content.innerHTML = html

        SetTypeLinks()
    }

    function SetTypeLinks() {
        let types = document.getElementsByTagName("type")

        for (var i = 0; i < types.length; ++i) {
            let type = types[i]

            if (!type.hasAttribute("load")) {
                let name = type.innerText.toLowerCase()

                // console.log(`./pages/types/${name}.html`)
                type.setAttribute("load", `./pages/types/${name}.html`)
                type.addEventListener("click", () => {
                    TryLoad(type)
                })
            }
        }
    }

    let items = document.getElementsByTagName("item")
    for (var i = 0; i < items.length; ++i) {
        const item = items[i]
        item.addEventListener("click", () => {
            TryLoad(item)
        })
    }
</script>

</html>